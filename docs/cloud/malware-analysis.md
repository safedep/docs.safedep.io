---
sidebar_position: 5
title: 🐛 Malicious Package Scanning
---

:::info
Malicious Package Scanning is a [SafeDep Cloud](./index.md) service.
It is currently available as early preview with limited support.
:::

This document describes how to use [vet](https://github.com/safedep/vet) for analyzing open source packages for malicious code. This is a [SafeDep Cloud](./index.md) hosted service and supports scanning package artifacts available in public package registries (e.g. `npm`) only.

## Supported Ecosystems

1. npm
2. PyPI
3. Go Modules
4. RubyGems
5. GitHub Actions
6. Visual Studio Code Extensions (VSX)

## Requirements

- You must have [vet](https://github.com/safedep/vet) `1.9.7` or above installed
- You must be onboarded to SafeDep Cloud and have access to

1. Tenant Domain
2. API Key

Refer to [SafeDep Cloud Quickstart](./quickstart.md) for more information on how to onboard and get an API key.

## Malicious Package Scanning with `vet`

### Scanning a Repository

The newly introduced `--malware` flag in `vet` allows you to scan a repository for malware. It can be used
with all other `vet` scanning options to active active scanning for malicious OSS packages.

To scan a repository for malware, use the following command

```shell
vet scan -D /path/to/code --malware
```

**Note:** We make a trade-off between coverage and speed. `vet` is configured
to wait for a `timeout` period for the malware analysis to complete. This
should not be a problem during pull requests or CI/CD pipelines because the
number of changed packages are usually low. The `timeout` can be adjusted using
`--malware-analysis-timeout` flag.

Other scanning options:

```shell
vet scan -M package-lock.json --malware
vet scan --purl pkg:/npm/llm-oracle@1.0.2 --malware
```

![](/img/vet-malysis-llm-oracle.png)

Scanning other ecosystems

```shell
vet scan -M requirements.txt --malware
vet scan -M go.mod --malware
vet scan -M Gemfile.lock --malware
```

### Scanning Visual Studio Code Extensions

Visual Studio Code Extension scanning is supported only for developer local
machines. Run the following command to scan a Visual Studio Code Extensions
in the local system.

```shell
vet scan --vsx --malware
```

### GitHub Actions

[vet-action](https://github.com/safedep/vet-action) has been extended to
support `cloud-mode` for malicious package scanning. When enabled, it will
actively scan packages changed during a pull request for malicious behaviour in
code. Follow [README.md](https://github.com/safedep/vet-action?tab=readme-ov-file#cloud-mode) to
activate malicious package protection in your GitHub repository.

Once enabled, `vet` will scan the changed packages for malware and provide the
results in the Pull Request.

![](/img/vet-action-malysis-1.png)

The comment can be expanded to view individual package analysis results.

![](/img/vet-action-malysis-2.png)

### Inspecting a Package

Package inspection allows using `vet` to perform a single package analysis,
including dumping the results as JSON. The package inspection command in `vet` is
currently experimental. Enable it by setting the environment variable

```shell
export VET_ENABLE_PACKAGE_INSPECT_COMMAND=true
```

Inspect an `npm` package for malware

```shell
vet inspect malware --purl pkg:/npm/llm-oracle@1.0.2
```

> **Note:** The package analysis will be performed asynchronously. The scanning usually takes a few minutes but may take longer depending on pending analysis tasks in the queue.

On scan completion, `vet` will show the status of the analysis and classify it as `MALICIOUS` or `SAFE`

![Scan Result](/img/llm-oracle-npm-malysis.png)

The analysis results can be exported as JSON using `--report-json` parameter

```shell
vet inspect malware \
  --purl pkg:/npm/llm-oracle@1.0.2 \
  --report-json /tmp/analysis.json
```
